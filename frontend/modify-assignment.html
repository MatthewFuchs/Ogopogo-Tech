<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modify Assignment</title>
    <link rel="stylesheet" href="css/assignment.css">
</head>
<body>

<main>
    <div class="container" id="modifyAssignmentForm">
        <h2>Modify Assignment</h2>

        <section id="questionsContainer">
            <textarea name="question" placeholder="Enter new question"></textarea>
            <button type="submit" class="btn btn-add">Add Question</button>

            <!-- Questions -->
        </section>
        
        <button class="btn btn-save" onclick="window.location.href='assignments-list.html';">Save Changes</button>
    </div>
</main>

<script>
let token = localStorage.getItem('userToken');
    if (!token) {
        token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY2MDBlOTgxOTZjMmRkNTQxY2ZmYzdlNyIsImlhdCI6MTcxMTMzNTgwOSwiZXhwIjoxNzEzOTI3ODA5fQ.UFgAtXOeg1r7j-4Ug5DOgN_EG1gqbjNkihJMKeC9mXY'
    }

document.addEventListener('DOMContentLoaded', async () => { 
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const assignmentId = urlParams.get('assignmentId');
    const questionsContainer = document.getElementById('questionsContainer');
    const addQuestionBtn = document.querySelector('.btn-add');

    try {
        const assignment = await fetch(`http://localhost:8080/api/assignments/${assignmentId}`)
                                 .then(res => res.json());

        displayQuestions(assignment.questions); 

        addQuestionBtn.addEventListener('click', handleAddQuestion);
    } catch (error) {
        console.error("Error fetching assignment:", error);
    }

    function displayQuestions(questions) {
        questions.forEach(question => {
            const questionItem = document.createElement('div');
            questionItem.classList.add('question-item');

            const questionText = document.createElement('h4');
            questionText.textContent = question;

            const editButton = document.createElement('button');
            editButton.classList.add('btn', 'btn-edit');
            editButton.textContent = 'Edit';

            const deleteButton = document.createElement('button');
            deleteButton.classList.add('btn', 'btn-delete');
            deleteButton.textContent = 'Delete';

            questionItem.appendChild(questionText);
            questionItem.appendChild(editButton);
            questionItem.appendChild(deleteButton);

            // Add event listeners to 'Edit' and 'Delete' buttons
            questionItem.querySelector('.btn-edit').addEventListener('click', () => {
                // Show the edit form
    });

    questionItem.querySelector('.btn-delete').addEventListener('click', () => {
        if (confirm('Are you sure you want to delete this question?')) {
            // Send DELETE request to `/api/questions/{questionId}`
        }
    });

    questionsContainer.appendChild(questionItem);
        });
    }

    async function handleAddQuestion() {
        const questionText = document.querySelector('textarea[name="question"]').value;

        try {
          const response = await fetch(`http://localhost:8080/api/assignments/question/${assignmentId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' , 'Authorization': `Bearer ${token}`},
              body: JSON.stringify({ question: questionText })
          });

          if (response.ok) {
              alert("Question added Succesfully!")
          } 
        } catch (error) {
            console.error("Error adding question:", error);
        }
    }

    function getAssignmentIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id'); 
    }
});
</script>

</body>
</html>
